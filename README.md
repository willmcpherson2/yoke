# hsrs

> Haskell ðŸ’ž Rust

This is a Haskell project template with Rust FFI.

## `nix develop`

This template contains a [Nix development environment](https://nix.dev/manual/nix/2.17/command-ref/new-cli/nix3-develop), but you can install Haskell and Rust however you want.

Run `nix develop` to enter the environment.

You can also use [nix-direnv](https://github.com/nix-community/nix-direnv) to enter it automatically.

To get the language servers in your editor you should use a `.envrc` compatible plugin like [envrc.el](https://github.com/purcell/envrc) for Emacs or [direnv.vim](https://github.com/direnv/direnv.vim) for Vim.

## `make run`

(Or just `make`)

This will run [`make build`](#make-build) and then `cabal run`.

## `make build`

This will run `cargo build`, outputting `lib/hsrs.h` and `lib/libhsrs.a`. This is your Rust library that Haskell will link to. The code is at [rs/lib.rs](rs/lib.rs). The header file is generated by [cbindgen](https://github.com/mozilla/cbindgen).

Then `cabal build` will be run, which will use [c2hs](https://github.com/haskell/c2hs) to create bindings to the Rust library. The interfacing code is at [hs/Lib.chs](hs/Lib.chs).

## `make clean`

This runs `cargo clean`, `cabal clean` and `rm -rf lib`.

## `make update`

This updates Nix, Cargo and Cabal dependencies.

## `make fmt`

This runs [`cargo fmt`](https://github.com/rust-lang/rustfmt), [`cabal-fmt`](https://github.com/phadej/cabal-fmt) and [`ormolu`](https://github.com/tweag/ormolu).
